<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TeamChat Â· Salon</title>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;700;800&family=DM+Mono:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body class="chat-page">

<header>
  <div class="header-left">
    <span class="header-logo">â—ˆ TeamChat</span>
    <span class="room-badge">Salon principal</span>
  </div>
  <div class="header-right">
    <span class="my-pseudo">{{ pseudo }}</span>
    <a class="logout-btn" href="/logout">Quitter</a>
  </div>
</header>

<div class="main">

  <!-- â”€â”€ Sidebar â”€â”€ -->
  <aside class="sidebar">
    <div class="sidebar-section">
      <p class="sidebar-title">ConnectÃ©s</p>
      <ul class="user-list" id="user-list"></ul>
    </div>

    <div class="voice-section">
      <p class="sidebar-title">Voix</p>

      <!-- SÃ©lecteur de micro -->
      <div class="mic-select-wrap">
        <span class="mic-select-label">ðŸŽ™ Micro</span>
        <select id="mic-select"></select>
      </div>

      <!-- Rejoindre / Raccrocher -->
      <button class="voice-btn" id="voice-btn" onclick="toggleVoice()" style="margin-top:10px;">
        <span class="mic-icon">ðŸ“ž</span>
        <span id="voice-label">Rejoindre l'appel</span>
      </button>

      <!-- Mute (affichÃ© uniquement en appel) -->
      <button class="mute-btn" id="mute-btn" onclick="toggleMute()" title="Couper le micro">
        ðŸŽ¤ Micro actif
      </button>

      <!-- Indicateurs audio des pairs -->
      <div class="peer-audio-list" id="peer-audio-list"></div>
    </div>
  </aside>

  <!-- â”€â”€ Zone de chat â”€â”€ -->
  <div class="chat-area">
    <div class="messages" id="messages">
      {% for msg in messages %}
        {% if msg.pseudo == pseudo %}
          <div class="msg mine">
            <div class="msg-meta">
              <span class="msg-pseudo">Vous</span>
              <span>{{ msg.created_at[11:16] if msg.created_at else '' }}</span>
            </div>
            <div class="msg-bubble">{{ msg.content }}</div>
          </div>
        {% else %}
          <div class="msg other">
            <div class="msg-meta">
              <span class="msg-pseudo">{{ msg.pseudo }}</span>
            </div>
            <div class="msg-bubble">{{ msg.content }}</div>
          </div>
        {% endif %}
      {% endfor %}
    </div>

    <div class="input-area">
      <textarea
        class="message-input"
        id="msg-input"
        placeholder="Ã‰crire un messageâ€¦ (EntrÃ©e pour envoyer)"
        rows="1"
      ></textarea>
      <button class="send-btn" onclick="sendMessage()">â†‘</button>
    </div>
  </div>

</div>

<div id="audio-container" style="display:none;"></div>

<script>const MY_PSEUDO = {{ pseudo | tojson }};</script>
<script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
